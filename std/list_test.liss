(import "test_utils" ["benchmark"])
(import "list") ; import all because this file is supposed to test all public functions
(import "assert")

(fn _mk_rand_vec [size]
    (fn _next [ix acc]
        (cond (>= ix size)
            acc
            (
                (let _acc (+ acc [(randn 100)]))
                (_next (+ ix 1) _acc)
            )
        )
    )
    (_next 0 [])
)

(fn _test []
    (
        (let vec (_mk_rand_vec 1000))
        (print "list: ")
        (println vec "\n")

        (test_utils:benchmark (fn [] (
            (print "find: ")
            (println (list:find vec 7))
            (print "find_all: ")
            (println (list:find_all vec 7))
        )))

        (test_utils:benchmark (fn [] (
            (print "range 0..2: ")
            (println (list:range vec 0 2))
            (print "range 2..10: ")
            (println (list:range vec 2 10))
        )))

        (test_utils:benchmark (fn [] (
            (print "merge-sorted: ")
            (println (list:mergesort vec))
        )))

        (test_utils:benchmark (fn [] (
            (print "quick-sorted: ")
            (println (list:quicksort vec))
        )))

        (test_utils:benchmark (fn [] (
            (print "sorted: ")
            (println (list:sort vec))
        )))

        (test_utils:benchmark (fn [] (
            (print "filtered < 10: ")
            (println (list:filter vec (fn [x] (< x 10))))
        )))

        (test_utils:benchmark (fn [] (
            (print "reduced < 10: ")
            (println (list:reduce vec (fn [acc x] (
                (+ acc (cond (< x 10) [x] []))
            )) []))
        )))

        (test_utils:benchmark (fn [] (
            (print "mapped * 2: ")
            (println (list:map vec (fn [x] (* x 2))))
        )))

        (test_utils:benchmark (fn [] (
            (let _lookup (_mk_rand_vec 100))
            (list:map _lookup (fn [x]
                (list:contains? vec x)
            ))
        )))
    )
)

; (_test)

(fn test_list_push []
    (let tests [
        (dict ["name" "null list"] ["input" null] ["want" null])
        (dict ["name" "empty list"] ["input" []] ["want" [1]])
        (dict ["name" "non-empty list"] ["input" [2 3 4] ] ["want" [2 3 4 1]])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let input (get test "input"))
        (let want (get test "want"))
        (let got (list:push input 1))
        (assert:list_equal got want)
        (println ": OK")
    ))
)
(test_list_push)


(fn test_list_reduce []
    (let arr [1 2 3 4 5])
    (let sum (list:reduce arr (fn [acc x] (+ acc x)) 0))
    (assert:equal sum 15)
)
(test_list_reduce)

(fn test_list_reverse []
    (let arr [5 3 8 1 2 7 4 6])
    (let rev (list:reverse arr))
    (assert:list_equal rev [6 4 7 2 1 8 3 5])
)
(test_list_reverse)
