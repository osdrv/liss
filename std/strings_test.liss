(import "assert" ["equal"])
(import "list" ["map"])
(import "strings")

((fn test_strings_join []
    (let tests [
        (dict ["name" "join null"] ["input" null] ["delim" ", "] ["want" null])
        (dict ["name" "join empty list"] ["input" []] ["delim" ", "] ["want" ""])
        (dict ["name" "join single element"] ["input" ["Hello"]] ["delim" ", "] ["want" "Hello"])
        (dict ["name" "join multiple elements"] ["input" ["Hello" "World" "from" "Liss"]] ["delim" " "] ["want" "Hello World from Liss"])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let input (get test "input"))
        (let delim (get test "delim"))
        (let want (get test "want"))
        (let got (strings:join input delim))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_match_all []
    (let tests [
        (dict ["name" "match_all no matches"] ["pattern" "a(bc)d"] ["s" "xyzxyzxyz"] ["want" []])
        (dict ["name" "match_all single match"] ["pattern" "a(bc)d"] ["s" "xyzabcdxyz"] ["want" [["abcd" "bc"]]])
        (dict ["name" "match_all multiple matches"] ["pattern" "a(bc)d"] ["s" "abcdxyzabcd123abcd"] ["want" [["abcd" "bc"] ["abcd" "bc"] ["abcd" "bc"]]])
        (dict ["name" "match_all overlapping matches"] ["pattern" "(\\d\\d)"] ["s" "12345"] ["want" [["12" "12"] ["34" "34"]]]) ; matches can not overlap
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let pattern (get test "pattern"))
        (let s (get test "s"))
        (let want (get test "want"))
        (let got (strings:match_all pattern s))
        (assert:deep_equal got want)
        (println ": OK")
    ))
))

((fn test_strings_reverse []
    (let tests [
        (dict ["name" "reverse null"] ["input" null] ["want" null])
        (dict ["name" "reverse empty string"] ["input" ""] ["want" ""])
        (dict ["name" "reverse single character"] ["input" "A"] ["want" "A"])
        (dict ["name" "reverse palindrome"] ["input" "madam"] ["want" "madam"])
        (dict ["name" "reverse regular string"] ["input" "Hello, World!"] ["want" "!dlroW ,olleH"])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let input (get test "input"))
        (let want (get test "want"))
        (let got (strings:reverse input))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_split []
    (let tests [
        (dict ["name" "split null"] ["input" null] ["delim" ","] ["want" null])
        (dict ["name" "split empty string"] ["input" ""] ["delim" ","] ["want" []])
        (dict ["name" "split no delimiter"] ["input" "HelloWorld"] ["delim" ","] ["want" ["HelloWorld"]])
        (dict ["name" "split single delimiter"] ["input" "Hello,World"] ["delim" ","] ["want" ["Hello" "World"]])
        (dict ["name" "split multiple delimiters"] ["input" "one,two,three,four"] ["delim" ","] ["want" ["one" "two" "three" "four"]])
        (dict ["name" "split consecutive delimiters"] ["input" "one,,two,,,three"] ["delim" ","] ["want" ["one" "" "two" "" "" "three"]])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let input (get test "input"))
        (let delim (get test "delim"))
        (let want (get test "want"))
        (let got (strings:split input delim))
        (assert:deep_equal got want)
        (println ": OK")
    ))
))

((fn test_strings_atoi []
    (let tests [
        (dict ["name" "atoi null"] ["input" null] ["want" null])
        (dict ["name" "atoi empty string"] ["input" ""]
            ["wantErr" "Error: \"atoi: empty string\""])
        (dict ["name" "atoi single digit"] ["input" "5"] ["want" 5])
        (dict ["name" "atoi multiple digits"] ["input" "12345"] ["want" 12345])
        (dict ["name" "atoi leading zeros"] ["input" "00042"] ["want" 42])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let input (get test "input"))
        (let want (get test "want"))
        (let wantErr (get test "wantErr"))
        (let got (try (strings:atoi input)))
        (cond (is_null? wantErr)
            (assert:equal got want)
            (assert:is_error_signature got wantErr)
        )
        (println ": OK")
    ))
))

((fn test_strings_has_prefix []
    (let tests [
        (dict ["name" "has_prefix null string"] ["s" null] ["prefix" "pre"]
            ["wantErr" "Error: \"has_prefix?: both arguments must be strings\""])
        (dict ["name" "has_prefix null prefix"] ["s" "string"] ["prefix" null]
            ["wantErr" "Error: \"has_prefix?: both arguments must be strings\""])
        (dict ["name" "has_prefix empty prefix"] ["s" "string"] ["prefix" ""] ["want" true])
        (dict ["name" "has_prefix matching prefix"] ["s" "hello world"] ["prefix" "hello"] ["want" true])
        (dict ["name" "has_prefix non-matching prefix"] ["s" "hello world"] ["prefix" "world"] ["want" false])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let prefix (get test "prefix"))
        (let want (get test "want"))
        (let wantErr (get test "wantErr"))
        (let got (try (strings:has_prefix? s prefix)))
        (cond (is_null? wantErr)
            (assert:equal got want)
            (assert:is_error_signature got wantErr)
        )
        (println ": OK")
    ))
))

((fn test_strings_has_sufix []
    (let tests [
        (dict ["name" "has_suffix empty suffix"] ["s" "string"] ["suffix" ""] ["want" true])
        (dict ["name" "has_suffix matching suffix"] ["s" "hello world"] ["suffix" "world"] ["want" true])
        (dict ["name" "has_suffix non-matching suffix"] ["s" "hello world"] ["suffix" "hello"] ["want" false])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let suffix (get test "suffix"))
        (let want (get test "want"))
        (let got (strings:has_suffix? s suffix))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_trim_prefix []
    (let tests [
        (dict ["name" "trim_prefix no prefix"] ["s" "hello world"] ["prefix" "world"] ["want" "hello world"])
        (dict ["name" "trim_prefix matching prefix"] ["s" "hello world"] ["prefix" "hello "] ["want" "world"])
        (dict ["name" "trim_prefix empty prefix"] ["s" "hello world"] ["prefix" ""] ["want" "hello world"])
        (dict ["name" "trim_prefix full string"] ["s" "hello"] ["prefix" "hello"] ["want" ""])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let prefix (get test "prefix"))
        (let want (get test "want"))
        (let got (strings:trim_prefix s prefix))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_trim_suffix []
    (let tests [
        (dict ["name" "trim_suffix no suffix"] ["s" "hello world"] ["suffix" "hello"] ["want" "hello world"])
        (dict ["name" "trim_suffix matching suffix"] ["s" "hello world"] ["suffix" " world"] ["want" "hello"])
        (dict ["name" "trim_suffix empty suffix"] ["s" "hello world"] ["suffix" ""] ["want" "hello world"])
        (dict ["name" "trim_suffix full string"] ["s" "hello"] ["suffix" "hello"] ["want" ""])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let suffix (get test "suffix"))
        (let want (get test "want"))
        (let got (strings:trim_suffix s suffix))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_trim_left []
    (let tests [
        (dict ["name" "trim_left no chars"] ["s" "  hello  "] ["chars" ""] ["want" "  hello  "])
        (dict ["name" "trim_left spaces"] ["s" "   hello  "] ["chars" " "] ["want" "hello  "])
        (dict ["name" "trim_left multiple chars"] ["s" "---***hello***---"] ["chars" "-*"] ["want" "hello***---"])
        (dict ["name" "trim_left all chars"] ["s" "aaaaaa"] ["chars" "a"] ["want" ""])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let chars (get test "chars"))
        (let want (get test "want"))
        (let got (strings:trim_left s chars))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_trim_right []
    (let tests [
        (dict ["name" "trim_right no chars"] ["s" "  hello  "] ["chars" ""] ["want" "  hello  "])
        (dict ["name" "trim_right spaces"] ["s" "  hello   "] ["chars" " "] ["want" "  hello"])
        (dict ["name" "trim_right multiple chars"] ["s" "---***hello***---"] ["chars" "-*"] ["want" "---***hello"])
        (dict ["name" "trim_right all chars"] ["s" "aaaaaa"] ["chars" "a"] ["want" ""])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let chars (get test "chars"))
        (let want (get test "want"))
        (let got (strings:trim_right s chars))
        (assert:equal got want)
        (println ": OK")
    ))
))

((fn test_strings_trim []
    (let tests [
        (dict ["name" "trim no chars"] ["s" "  hello  "] ["chars" ""] ["want" "  hello  "])
        (dict ["name" "trim spaces"] ["s" "   hello   "] ["chars" " "] ["want" "hello"])
        (dict ["name" "trim multiple chars"] ["s" "---***hello***---"] ["chars" "-*"] ["want" "hello"])
        (dict ["name" "trim all chars"] ["s" "aaaaaa"] ["chars" "a"] ["want" ""])
    ])
    (list:map tests (fn [test]
        (print "Running test: " (get test "name"))
        (let s (get test "s"))
        (let chars (get test "chars"))
        (let want (get test "want"))
        (let got (strings:trim s chars))
        (assert:equal got want)
        (println ": OK")
    ))
))
